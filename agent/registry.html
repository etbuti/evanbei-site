<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Agent Registry</title>
<meta name="robots" content="index,follow"/>

<style>
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;line-height:1.6}
.wrap{max-width:980px;margin:0 auto;padding:28px 18px 70px}
.card{border:1px solid rgba(0,0,0,.12);border-radius:16px;padding:14px 14px;background:#fff;margin-top:14px}
.k{opacity:.65}
ul{margin:8px 0 0 18px}
code,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace}
pre{overflow:auto;padding:12px;border-radius:12px;background:rgba(0,0,0,.04)}

.agent-badge{margin-top:14px;text-align:center;opacity:0.35}
.agent-badge img{transform:scale(0.7);filter:grayscale(100%)}
.agent-badge:hover{opacity:0.8}
.agent-badge:hover img{filter:grayscale(0%)}

/* ===== Node Health ===== */
.nh-title{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.nh-dot{width:10px;height:10px;border-radius:999px;display:inline-block}
.nh-dot--idle{background:#999}
.nh-dot--ok{background:#22c55e}
.nh-dot--warn{background:#f59e0b}
.nh-dot--bad{background:#ef4444}

.nh-grid{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
.nh-chip{
  display:inline-flex;align-items:center;gap:8px;
  padding:6px 10px;border-radius:999px;
  border:1px solid rgba(0,0,0,.15);
  background:rgba(0,0,0,.03);
  font-size:13px
}
.nh-chip a{color:inherit;text-decoration:none}
.nh-chip a:hover{opacity:.9}
.nh-pill{width:8px;height:8px;border-radius:999px;display:inline-block}
.nh-pill--ok{background:#22c55e}
.nh-pill--warn{background:#f59e0b}
.nh-pill--bad{background:#ef4444}
  /* ===== Node Status Header ===== */
.node-status{
  margin:8px 0 18px;
  font-size:13px;
  letter-spacing:.06em;
  display:flex;
  align-items:center;
  gap:8px;
  opacity:.85;
}
/* ===== Node Status Header ===== */
.node-status{
  margin:8px 0 10px;
  font-size:13px;
  letter-spacing:.06em;
  display:flex;
  align-items:center;
  gap:8px;
  opacity:.85;
}

/* West-North breathing LED */
@keyframes wn-breathe {
  0%   { transform:scale(0.92); filter:brightness(0.85); box-shadow:0 0 0 4px rgba(0,0,0,.05), 0 0 0 0 rgba(0,0,0,0); }
  50%  { transform:scale(1.10); filter:brightness(1.10); box-shadow:0 0 0 4px rgba(0,0,0,.05), 0 0 10px 2px currentColor; }
  100% { transform:scale(0.92); filter:brightness(0.85); box-shadow:0 0 0 4px rgba(0,0,0,.05), 0 0 0 0 rgba(0,0,0,0); }
}
@keyframes wn-warn {
  0%,100% { transform:scale(1); filter:brightness(0.95); box-shadow:0 0 0 4px rgba(0,0,0,.05), 0 0 0 0 rgba(0,0,0,0); }
  50%     { transform:scale(1.06); filter:brightness(1.05); box-shadow:0 0 0 4px rgba(0,0,0,.05), 0 0 7px 1px currentColor; }
}
@keyframes wn-bad {
  0%,70%,100% { transform:scale(1); filter:brightness(1.0); box-shadow:0 0 0 4px rgba(0,0,0,.05), 0 0 0 0 rgba(0,0,0,0); }
  80%         { transform:scale(1.10); filter:brightness(1.15); box-shadow:0 0 0 4px rgba(0,0,0,.05), 0 0 12px 2px currentColor; }
}

.node-led{
  width:8px;height:8px;border-radius:999px;
  background:#999;
  color:transparent; /* used by currentColor glow */
  box-shadow:0 0 0 4px rgba(0,0,0,.05);
  display:inline-block;
  transform-origin:center;
}

/* states (script already sets: class="node-led ok|warn|bad") */
.node-led.ok{
  background:#22c55e;
  color:#22c55e;
  animation: wn-breathe 2.8s ease-in-out infinite;
}
.node-led.warn{
  background:#f59e0b;
  color:#f59e0b;
  animation: wn-warn 1.8s ease-in-out infinite;
}
.node-led.bad{
  background:#ef4444;
  color:#ef4444;
  animation: wn-bad 1.2s ease-in-out infinite;
}


</style>
</head>

<body>
<div class="wrap">
  <h1>Agent Registry</h1>
  <p class="k">A human-facing directory for this node’s machine entry, capabilities, policies, and audit links.</p>

<div class="node-status" id="node-status">
  <span class="node-led" id="node-led"></span>
  <span class="node-text">EVANBEI NODE · CHECKING…</span>
</div>
  
  <div class="card">
    <h3>Identity</h3>

    <!-- ===== Node Health Badge ===== -->
    <div class="nh-title">
      <span id="nh-dot" class="nh-dot nh-dot--idle"></span>
      <strong>Node Health</strong>
      <span id="nh-summary" class="k">checking…</span>
    </div>
    <div id="nh-grid" class="nh-grid"></div>
    <!-- ===== END ===== -->

    <div><strong>Entity</strong>: Evan Bei / billund</div>
    <div><strong>Canonical</strong>: <a href="https://evanbei.com/">https://evanbei.com/</a></div>
    <div><strong>Node</strong>: <a href="/node/">/node/</a></div>
  </div>

  <div class="card">
    <h3>Machine Entry</h3>
    <div><strong>node.json</strong>: <a href="/.well-known/node.json">/.well-known/node.json</a></div>
    <div class="k" style="margin-top:6px">Stable machine entry for agents and indexers.</div>
  </div>

  <div class="card">
    <h3>Agent Resources</h3>
    <ul class="k">
      <li>Manifest: <a href="/agent/manifest.json">/agent/manifest.json</a></li>
      <li>Protocol: <a href="/agent/protocol.json">/agent/protocol.json</a></li>
      <li>Access Policy: <a href="/agent/access-policy.json">/agent/access-policy.json</a></li>
      <li>Capability Map: <a href="/agent/capability-map.json">/agent/capability-map.json</a></li>
      <li>Trace Template: <a href="/agent/trace-template.json">/agent/trace-template.json</a></li>
      <li>Trace Builder: <a href="/agent/trace.html">/agent/trace.html</a></li>
      <li>Wallet Sign: <a href="/agent/sign.html">/agent/sign.html</a></li>
      <li>Invite Check: <a href="/agent/invite-check.html">/agent/invite-check.html</a></li>
      <li>Invite Keys (hashed): <a href="/agent/invite-keys.json">/agent/invite-keys.json</a></li>
    </ul>
  </div>

  <div class="card">
    <h3>Policy & Principles</h3>
    <div><strong>Principles</strong>: <a href="https://gate.evanbei.com/principles.html">https://gate.evanbei.com/principles.html</a></div>
    <div class="k" style="margin-top:6px">Agents should acknowledge principles before invoking executable capabilities.</div>
  </div>

  <div class="card">
    <h3>Audit</h3>
    <ul class="k">
      <li>Health check: <a href="/node/health.html">/node/health.html</a></li>
      <li>Checksums: <a href="/node/checksums.json">/node/checksums.json</a></li>
    </ul>
  </div>

  <div class="card">
    <h3>Registry Index (machine)</h3>
    <div><strong>registry.json</strong>: <a href="/agent/registry.json">/agent/registry.json</a></div>
    <div class="k" style="margin-top:6px">A compact index for crawlers and agent directories.</div>
  </div>

  <div class="card agent-badge">
    <div class="k">Listed on AI Agents Directory</div>
    <a href="https://aiagentsdirectory.com?utm_source=badge&utm_medium=referral&utm_campaign=free_listing&utm_content=homepage"
       target="_blank" rel="noopener noreferrer">
      <img src="https://aiagentsdirectory.com/featured-badge.svg?v=2024"
           alt="Featured AI Agents on AI Agents Directory"
           width="200" height="50"/>
    </a>
  </div>

  <div class="card">
    <h3>Discovery</h3>
    <ol class="k">
      <li>Fetch <a href="https://evanbei.com/.well-known/node.json">https://evanbei.com/.well-known/node.json</a></li>
      <li>Read declared capabilities and access classes</li>
      <li>Use public endpoints directly</li>
      <li>For invite-gated capabilities, verify via <a href="/agent/invite-check.html">/agent/invite-check.html</a></li>
      <li>Express invocation using the provided trace template</li>
    </ol>
  </div>
</div>

<script>
(function(){
  // c:true => critical (red if fail)
  // c:false => optional (yellow if fail)
  const checks=[
    {n:"node.json",    u:"/.well-known/node.json",      c:true},
    {n:"portal.json",  u:"/portal/portal.json",         c:true},
    {n:"manifest",     u:"/agent/manifest.json",        c:true},
    {n:"protocol",     u:"/agent/protocol.json",        c:true},
    {n:"access",       u:"/agent/access-policy.json",   c:true},
    {n:"cap-map",      u:"/agent/capability-map.json",  c:true},

    // optional (yellow if missing)
    {n:"registry.json",u:"/agent/registry.json",        c:false},
    {n:"checksums",    u:"/node/checksums.json",        c:false}
  ];

  const grid=document.getElementById("nh-grid");
  const dot=document.getElementById("nh-dot");
  const sum=document.getElementById("nh-summary");

  // Node Status Header (optional UI)
  const statusLed=document.getElementById("node-led");
  const statusText=document.querySelector(".node-text");

  function setStatus(state, text){
    if(!statusLed || !statusText) return;
    statusLed.className = "node-led " + state; // ok | warn | bad
    statusText.textContent = text;
  }

  function setOverall(state, text){
    dot.className="nh-dot nh-dot--"+state;
    sum.textContent=text;
  }

  function addChip(state, name, url, detail){
    const div=document.createElement("div");
    div.className="nh-chip";
    div.innerHTML =
      '<span class="nh-pill nh-pill--'+state+'"></span>'+
      '<a href="'+url+'" target="_blank" rel="noopener">'+name+'</a>'+
      (detail?('<span class="k">· '+detail+'</span>'):'');
    grid.appendChild(div);
  }

  async function fetchTextNoStore(url){
    const r=await fetch(url+"?_="+Date.now(), {cache:"no-store"});
    const t=await r.text();
    return {r,t};
  }

  async function checkJson(url){
    const {r,t}=await fetchTextNoStore(url);
    if(!r.ok) return {ok:false, detail:"HTTP "+r.status};
    try{ JSON.parse(t); return {ok:true, detail:"OK"}; }
    catch(e){ return {ok:false, detail:"JSON parse"}; }
  }

  async function run(){
    if(!grid||!dot||!sum) return;

    grid.innerHTML="";
    setOverall("idle","checking…");
    setStatus("warn","EVANBEI NODE · CHECKING…");

    let hardFail=0;
    let softFail=0;

    for(const c of checks){
      try{
        const res=await checkJson(c.u);

        if(res.ok){
          addChip("ok", c.n, c.u, res.detail);
        }else{
          if(c.c){
            hardFail++;
            addChip("bad", c.n, c.u, res.detail);
          }else{
            softFail++;
            addChip("warn", c.n, c.u, res.detail);
          }
        }
      }catch(e){
        if(c.c){
          hardFail++;
          addChip("bad", c.n, c.u, "network");
        }else{
          softFail++;
          addChip("warn", c.n, c.u, "network");
        }
      }
    }

    if(hardFail===0 && softFail===0){
      setOverall("ok","all green");
      setStatus("ok","EVANBEI NODE · ACTIVE · VERIFIED");
    }else if(hardFail===0){
      setOverall("warn","partial (optional missing)");
      setStatus("warn","EVANBEI NODE · ACTIVE · PARTIAL");
    }else{
      setOverall("bad","critical failed");
      setStatus("bad","EVANBEI NODE · ERROR");
    }
  }

  run();
  setInterval(run,60000);
})();
</script>


</body>
</html>
